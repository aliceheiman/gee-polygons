# extract


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## The Core Primitive

The heart of gee-polygons is one powerful primitive:

``` python
site.extract_categorical(layer, years=[2018, 2019, 2020])
```

Given: - A polygon (Site) - A categorical raster descriptor
(CategoricalLayer) - A list of years

It returns a tidy DataFrame with pixel counts and areas per class, per
year.

**This function knows nothing about MapBiomas, deforestation, or
Brazil.** It’s pure geometry + categorical values + time.

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            &#10;

------------------------------------------------------------------------

<a
href="https://github.com/aliceheiman/gee-polygons/blob/main/gee_polygons/extract.py#L20"
target="_blank" style="float:right; font-size:smaller">source</a>

### Site.extract_categorical

``` python

def extract_categorical(
    layer:CategoricalLayer, years:list, max_pixels:int=1000000000
)->DataFrame:

```

*Extract per-year pixel counts and areas from a categorical raster.*

Supports two temporal modes: - ‘band’: Each year is a band in a single
Image (e.g., MapBiomas) - ‘collection’: An ImageCollection filtered by
date (e.g., Dynamic World)

Args: layer: A CategoricalLayer describing the data source years: List
of years to extract max_pixels: Maximum pixels for reduction (default
1e9)

Returns: A tidy DataFrame with columns: - site_id: Site identifier -
year: Year of observation - class_value: Integer class value - count:
Pixel count - area_ha: Area in hectares - class_name: Human-readable
name (if available in layer)

## Example Usage

Let’s test with a simple example. First, we need to initialize GEE and
load a site.

``` python
# Initialize Earth Engine
ee.Authenticate()
ee.Initialize(project='hs-brazilreforestation')
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            &#10;

``` python
from gee_polygons.site import load_sites
sites = load_sites('../data/restoration_sites_subset.geojson')
site = sites[8]
print(site)
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            &#10;

    Site(id=9368, start_year=2012)

``` python
# Define a layer (or use a preset from gee_polygons.datasets)
layer = CategoricalLayer(
     asset_id='projects/mapbiomas-public/assets/brazil/lulc/collection10/mapbiomas_brazil_collection10_coverage_v2',
     band_pattern='classification_{}',
     scale=30
)

# Extract stats
df = site.extract_categorical(layer, years=[2012, 2013, 2014, 2015])
df.head(10)
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">site_id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">class_value</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">area_ha</th>
<th data-quarto-table-cell-role="th">class_name</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>9368</td>
<td>2012</td>
<td>21</td>
<td>147.211765</td>
<td>13.249059</td>
<td>None</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>9368</td>
<td>2012</td>
<td>3</td>
<td>9.196078</td>
<td>0.827647</td>
<td>None</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2</td>
<td>9368</td>
<td>2013</td>
<td>21</td>
<td>99.458824</td>
<td>8.951294</td>
<td>None</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">3</td>
<td>9368</td>
<td>2013</td>
<td>3</td>
<td>56.949020</td>
<td>5.125412</td>
<td>None</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">4</td>
<td>9368</td>
<td>2014</td>
<td>21</td>
<td>86.427451</td>
<td>7.778471</td>
<td>None</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">5</td>
<td>9368</td>
<td>2014</td>
<td>3</td>
<td>69.980392</td>
<td>6.298235</td>
<td>None</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">6</td>
<td>9368</td>
<td>2015</td>
<td>3</td>
<td>156.407843</td>
<td>14.076706</td>
<td>None</td>
</tr>
</tbody>
</table>

</div>

The output is always a tidy DataFrame:

<table>
<thead>
<tr>
<th>site_id</th>
<th>year</th>
<th>class_value</th>
<th>count</th>
<th>area_ha</th>
<th>class_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>3107</td>
<td>2020</td>
<td>3</td>
<td>1520</td>
<td>136.8</td>
<td>None</td>
</tr>
<tr>
<td>3107</td>
<td>2020</td>
<td>5</td>
<td>203</td>
<td>18.3</td>
<td>None</td>
</tr>
<tr>
<td>3107</td>
<td>2021</td>
<td>3</td>
<td>1701</td>
<td>153.1</td>
<td>None</td>
</tr>
</tbody>
</table>

If the
[`CategoricalLayer`](https://aliceheiman.github.io/gee-polygons/layers.html#categoricallayer)
has a `class_map`, the `class_name` column will be populated.

We can also try with a pre-set dataset.

``` python
from gee_polygons.datasets.mapbiomas import MAPBIOMAS_DEFREG
df = site.extract_categorical(MAPBIOMAS_DEFREG, years=range(2012, 2015))
df.head(10)
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">site_id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">class_value</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">area_ha</th>
<th data-quarto-table-cell-role="th">class_name</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>9368</td>
<td>2012</td>
<td>1</td>
<td>147.211765</td>
<td>13.249059</td>
<td>Anthropic</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>9368</td>
<td>2012</td>
<td>2</td>
<td>0.462745</td>
<td>0.041647</td>
<td>Primary Vegetation</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2</td>
<td>9368</td>
<td>2012</td>
<td>3</td>
<td>8.733333</td>
<td>0.786000</td>
<td>Secondary Vegetation</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">3</td>
<td>9368</td>
<td>2013</td>
<td>1</td>
<td>99.458824</td>
<td>8.951294</td>
<td>Anthropic</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">4</td>
<td>9368</td>
<td>2013</td>
<td>2</td>
<td>0.462745</td>
<td>0.041647</td>
<td>Primary Vegetation</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">5</td>
<td>9368</td>
<td>2013</td>
<td>3</td>
<td>8.733333</td>
<td>0.786000</td>
<td>Secondary Vegetation</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">6</td>
<td>9368</td>
<td>2013</td>
<td>5</td>
<td>47.752941</td>
<td>4.297765</td>
<td>Secondary Veg Regrowth</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">7</td>
<td>9368</td>
<td>2014</td>
<td>1</td>
<td>86.427451</td>
<td>7.778471</td>
<td>Anthropic</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">8</td>
<td>9368</td>
<td>2014</td>
<td>2</td>
<td>0.462745</td>
<td>0.041647</td>
<td>Primary Vegetation</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">9</td>
<td>9368</td>
<td>2014</td>
<td>3</td>
<td>56.486275</td>
<td>5.083765</td>
<td>Secondary Vegetation</td>
</tr>
</tbody>
</table>

</div>

## Visualizing Layers

Before extracting stats, it’s useful to visually verify the data. The
`show_layer` method displays the categorical raster for specified years
with the site polygon overlaid.

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            &#10;

------------------------------------------------------------------------

<a
href="https://github.com/aliceheiman/gee-polygons/blob/main/gee_polygons/extract.py#L111"
target="_blank" style="float:right; font-size:smaller">source</a>

### Site.show_layer

``` python

def show_layer(
    layer:CategoricalLayer, years:list, zoom:int=14, basemap:str='SATELLITE', site_color:str='blue',
    buffer_m:Optional=None
)->Map:

```

*Display a categorical layer for multiple years with the site overlaid.*

Supports both temporal modes: - ‘band’: Shows each year’s band from a
single Image - ‘collection’: Shows mode-reduced composite per year

Args: layer: A CategoricalLayer to visualize years: List of years to add
as layers zoom: Initial zoom level (default 14) basemap: Basemap type
(default ‘SATELLITE’) site_color: Color for site boundary (default
‘blue’) buffer_m: Optional buffer around site for clipping display

Returns: A geemap.Map with yearly classification layers

``` python
# Example: Visualize the layer with a buffer around the site
site.show_layer(MAPBIOMAS_DEFREG, years=range(2010, 2018), buffer_m=500)
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            &#10;

    Map(center=[-22.511306816393418, -42.27634385094392], controls=(WidgetControl(options=['position', 'transparen…

## Continuous Extraction

For continuous data (NDVI, EVI, temperature, etc.), use
`extract_continuous`. It supports: - **Multi-band extraction**: Get
multiple bands in one call - **Preprocessing hooks**: Dataset-specific
logic (cloud masking, index computation) via `layer.preprocess` -
**Temporal aggregation**: `'all'` (per-image), `'monthly'`, or
`'yearly'`

The function is completely dataset-agnostic — all dataset-specific logic
lives in the `preprocess` function defined in the layer.

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            &#10;

------------------------------------------------------------------------

<a
href="https://github.com/aliceheiman/gee-polygons/blob/main/gee_polygons/extract.py#L184"
target="_blank" style="float:right; font-size:smaller">source</a>

### Site.extract_continuous

``` python

def extract_continuous(
    layer:ContinuousLayer, start_date:str, end_date:str, reducer:Literal='mean', frequency:Literal='all',
    max_pixels:int=1000000000
)->DataFrame:

```

*Extract continuous raster statistics over time for a site.*

Completely dataset-agnostic. All preprocessing (cloud masking, index
computation, scaling) is handled by the layer’s `preprocess` function.

Args: layer: ContinuousLayer with bands to extract and optional
preprocess start_date: Start date (YYYY-MM-DD) end_date: End date
(YYYY-MM-DD) reducer: Spatial aggregation (‘mean’, ‘median’, ‘min’,
‘max’) frequency: Temporal output (‘all’, ‘monthly’, ‘yearly’)
max_pixels: Maximum pixels for reduction

Returns: DataFrame with columns: site_id, date/year/month, and one
column per band

### Example: Continuous Extraction

Using Sentinel-2 NDVI/EVI with preprocessing defined in the dataset
module:

``` python
# Example with Sentinel-2 NDVI/EVI (requires updated datasets/sentinel2.py)
from gee_polygons.datasets.sentinel2 import SENTINEL2_NDVI_EVI

# Yearly NDVI/EVI summary
df = site.extract_continuous(
    SENTINEL2_NDVI_EVI,
    start_date='2018-01-01',
    end_date='2020-12-31',
    reducer='median',
    frequency='all'
)
df.head()
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">site_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">NDVI</th>
<th data-quarto-table-cell-role="th">EVI</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>9368</td>
<td>2018-01-09</td>
<td>0.806691</td>
<td>0.591811</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>9368</td>
<td>2018-02-08</td>
<td>0.884718</td>
<td>0.589342</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2</td>
<td>9368</td>
<td>2018-12-15</td>
<td>0.885487</td>
<td>0.596724</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">3</td>
<td>9368</td>
<td>2018-12-20</td>
<td>0.870644</td>
<td>0.592598</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">4</td>
<td>9368</td>
<td>2018-12-25</td>
<td>0.491157</td>
<td>0.659755</td>
</tr>
</tbody>
</table>

</div>

``` python
df.head(10)
```

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
&#10;                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
&#10;                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
&#10;                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">site_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">NDVI</th>
<th data-quarto-table-cell-role="th">EVI</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>9368</td>
<td>2018-01-09</td>
<td>0.806691</td>
<td>0.591811</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>9368</td>
<td>2018-02-08</td>
<td>0.884718</td>
<td>0.589342</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2</td>
<td>9368</td>
<td>2018-12-15</td>
<td>0.885487</td>
<td>0.596724</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">3</td>
<td>9368</td>
<td>2018-12-20</td>
<td>0.870644</td>
<td>0.592598</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">4</td>
<td>9368</td>
<td>2018-12-25</td>
<td>0.491157</td>
<td>0.659755</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">5</td>
<td>9368</td>
<td>2018-12-30</td>
<td>0.873436</td>
<td>0.623111</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">6</td>
<td>9368</td>
<td>2019-01-04</td>
<td>0.846921</td>
<td>0.589451</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">7</td>
<td>9368</td>
<td>2019-01-09</td>
<td>0.892792</td>
<td>0.600742</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">8</td>
<td>9368</td>
<td>2019-01-14</td>
<td>0.893780</td>
<td>0.612306</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">9</td>
<td>9368</td>
<td>2019-01-19</td>
<td>0.338589</td>
<td>0.800424</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">10</td>
<td>9368</td>
<td>2019-01-24</td>
<td>0.890900</td>
<td>0.611940</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">11</td>
<td>9368</td>
<td>2019-01-29</td>
<td>0.895227</td>
<td>0.604959</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">12</td>
<td>9368</td>
<td>2019-02-03</td>
<td>0.852337</td>
<td>0.603106</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">13</td>
<td>9368</td>
<td>2019-02-08</td>
<td>0.454743</td>
<td>0.589876</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">14</td>
<td>9368</td>
<td>2019-02-13</td>
<td>-0.013164</td>
<td>-0.501578</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">15</td>
<td>9368</td>
<td>2019-02-18</td>
<td>0.814663</td>
<td>0.732076</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">16</td>
<td>9368</td>
<td>2019-02-23</td>
<td>0.919677</td>
<td>0.455631</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">17</td>
<td>9368</td>
<td>2019-02-28</td>
<td>0.720851</td>
<td>0.546486</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">18</td>
<td>9368</td>
<td>2019-03-05</td>
<td>0.801259</td>
<td>0.609721</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">19</td>
<td>9368</td>
<td>2019-03-10</td>
<td>0.876676</td>
<td>0.613873</td>
</tr>
</tbody>
</table>

</div>
